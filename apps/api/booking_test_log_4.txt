
> api@1.0.0 test
> jest --config jest.config.js tests/integration/booking.test.ts

  console.log
    Param Adventures API: Sentry Instrumented ≡ƒö¡

      at Object.<anonymous> (src/instrument.ts:17:9)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (../../node_modules/dotenv/lib/main.js:142:11)

2026-01-05 22:19:39 [33mwarn[39m: Google OAuth credentials missing. Social login disabled.
  console.log
    --> Backend Initialized (v1.2.0) - Restore Route Active <--

      at Object.<anonymous> (src/app.ts:48:9)

  console.log
    Γ£à Redis connected

      at EventEmitter.<anonymous> (src/lib/redis.ts:16:13)

2026-01-05 22:19:40 [31merror[39m: TypeError: Cannot read properties of undefined (reading 'catch')
    at BookingService.createBooking (C:\Users\akash\Documents\Param_Adventures_Phase1\apps\api\src\services\booking.service.ts:51:7)
    at C:\Users\akash\Documents\Param_Adventures_Phase1\apps\api\src\controllers\bookings\createBooking.controller.ts:14:19
  console.error
    Global Error Handler Caught: TypeError: Cannot read properties of undefined (reading 'catch')
        at BookingService.createBooking (C:\Users\akash\Documents\Param_Adventures_Phase1\apps\api\src\services\booking.service.ts:51:7)
        at C:\Users\akash\Documents\Param_Adventures_Phase1\apps\api\src\controllers\bookings\createBooking.controller.ts:14:19

    [0m [90m 12 |[39m   [33mSentry[39m[33m.[39mcaptureException(err)[33m;[39m
     [90m 13 |[39m
    [31m[1m>[22m[39m[90m 14 |[39m   console[33m.[39merror([32m"Global Error Handler Caught:"[39m[33m,[39m err)[33m;[39m [90m// Force console log[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m
     [90m 16 |[39m   [36mif[39m (err [36minstanceof[39m [33mHttpError[39m [33m||[39m err[33m.[39mname [33m===[39m [32m"HttpError"[39m) {
     [90m 17 |[39m     [36mconst[39m status [33m=[39m (err [36mas[39m any)[33m.[39mstatus [33m||[39m [35m500[39m[33m;[39m[0m

      at errorHandler (src/middlewares/error.middleware.ts:14:11)
      at Layer.handleError (../../node_modules/router/lib/layer.js:116:17)
      at trimPrefix (../../node_modules/router/index.js:340:13)
      at ../../node_modules/router/index.js:297:9
      at processParams (../../node_modules/router/index.js:582:12)
      at next (../../node_modules/router/index.js:291:5)
      at ../../node_modules/router/index.js:688:15
      at next (../../node_modules/router/index.js:276:14)
      at next (../../node_modules/router/lib/route.js:132:14)

2026-01-05 22:19:40 [32minfo[39m: ::ffff:127.0.0.1 - - [05/Jan/2026:16:49:40 +0000] "POST /bookings HTTP/1.1" 500 69 "-" "-"
  console.log
    Create Booking Error: {
      "error": {
        "code": "INTERNAL_ERROR",
        "message": "Internal Server Error"
      }
    }

      at Object.<anonymous> (tests/integration/booking.test.ts:79:15)

2026-01-05 22:19:40 [32minfo[39m: ::ffff:127.0.0.1 - - [05/Jan/2026:16:49:40 +0000] "GET /bookings/me HTTP/1.1" 200 508 "-" "-"
2026-01-05 22:19:40 [31merror[39m: HttpError: Trip not found
    at new HttpError (C:\Users\akash\Documents\Param_Adventures_Phase1\apps\api\src\utils\httpError.js:32:24)
    at BookingService.createBooking (C:\Users\akash\Documents\Param_Adventures_Phase1\apps\api\src\services\booking.service.ts:11:13)
    at C:\Users\akash\Documents\Param_Adventures_Phase1\apps\api\src\controllers\bookings\createBooking.controller.ts:14:19
  console.error
    Global Error Handler Caught: Error [HttpError]: Trip not found
        at new HttpError (C:\Users\akash\Documents\Param_Adventures_Phase1\apps\api\src\utils\httpError.js:32:24)
        at BookingService.createBooking (C:\Users\akash\Documents\Param_Adventures_Phase1\apps\api\src\services\booking.service.ts:11:13)
        at C:\Users\akash\Documents\Param_Adventures_Phase1\apps\api\src\controllers\bookings\createBooking.controller.ts:14:19 {
      status: 404,
      code: 'NOT_FOUND'
    }

    [0m [90m 12 |[39m   [33mSentry[39m[33m.[39mcaptureException(err)[33m;[39m
     [90m 13 |[39m
    [31m[1m>[22m[39m[90m 14 |[39m   console[33m.[39merror([32m"Global Error Handler Caught:"[39m[33m,[39m err)[33m;[39m [90m// Force console log[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 15 |[39m
     [90m 16 |[39m   [36mif[39m (err [36minstanceof[39m [33mHttpError[39m [33m||[39m err[33m.[39mname [33m===[39m [32m"HttpError"[39m) {
     [90m 17 |[39m     [36mconst[39m status [33m=[39m (err [36mas[39m any)[33m.[39mstatus [33m||[39m [35m500[39m[33m;[39m[0m

      at errorHandler (src/middlewares/error.middleware.ts:14:11)
      at Layer.handleError (../../node_modules/router/lib/layer.js:116:17)
      at trimPrefix (../../node_modules/router/index.js:340:13)
      at ../../node_modules/router/index.js:297:9
      at processParams (../../node_modules/router/index.js:582:12)
      at next (../../node_modules/router/index.js:291:5)
      at ../../node_modules/router/index.js:688:15
      at next (../../node_modules/router/index.js:276:14)
      at next (../../node_modules/router/lib/route.js:132:14)

2026-01-05 22:19:40 [32minfo[39m: ::ffff:127.0.0.1 - - [05/Jan/2026:16:49:40 +0000] "POST /bookings HTTP/1.1" 404 57 "-" "-"
2026-01-05 22:19:40 [32minfo[39m: ::ffff:127.0.0.1 - - [05/Jan/2026:16:49:40 +0000] "POST /bookings/9bc296d3-317a-4f07-9e74-f8fc5430cbea/cancel HTTP/1.1" 200 445 "-" "-"
node.exe : FAIL tests/
integration/booking.te
st.ts (8.299 s)
At C:\Program Files\no
dejs\npm.ps1:29 char:3
+   & $NODE_EXE 
$NPM_CLI_JS $args
+   ~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~
    + CategoryInfo    
          : NotSpeci  
  fied: (FAIL tests   
 /inte...st.ts (8.    
299 s):String) []    
, RemoteException
    + FullyQualifiedE 
   rrorId : NativeCo  
  mmandError
 
  ΓùÅ Booking 
Integration ΓÇ║ 
should create a new 
booking

    expect(received).t
oBe(expected) // 
Object.is equality

    Expected: 201
    Received: 500

    [0m [90m 80 
|[39m     }
     [90m 81 |[39m
    [31m[1m>[22m[3
9m[90m 82 |[39m     
expect(res[33m.[39ms
tatus)[33m.[39mtoBe(
[35m201[39m)[33m;[
39m
     [90m    |[39m  
                      
[31m[1m^[22m[39m
     [90m 83 |[39m  
   expect(res[33m.[3
9mbody[33m.[39mdata)
[33m.[39mtoHavePrope
rty([32m"id"[39m)[3
3m;[39m
     [90m 84 |[39m  
   expect(res[33m.[3
9mbody[33m.[39mdata
[33m.[39mtripId)[33m
.[39mtoBe(tripId)[33
m;[39m
     [90m 85 |[39m  
   expect(res[33m.[3
9mbody[33m.[39mdata
[33m.[39mguests)[33m
.[39mtoBe([35m2[39m
)[33m;[39m[0m

      at 
Object.<anonymous> (te
sts/integration/bookin
g.test.ts:82:24)

  ΓùÅ Booking 
Integration ΓÇ║ 
should get user's 
bookings

    expect(received).t
oBe(expected) // 
Object.is equality

    Expected: true
    Received: false

    [0m [90m 92 
|[39m
     [90m 93 |[39m  
   expect(res[33m.[3
9mstatus)[33m.[39mto
Be([35m200[39m)[33m
;[39m
    [31m[1m>[22m[3
9m[90m 94 |[39m     
expect([33mArray[39m
[33m.[39misArray(res
[33m.[39mbody[33m.
[39mdata))[33m.[39mt
oBe([36mtrue[39m)[3
3m;[39m
     [90m    |[39m  
                      
                  
[31m[1m^[22m[39m
     [90m 95 |[39m  
   expect(res[33m.[3
9mbody[33m.[39mdata
[33m.[39mlength)[33m
.[39mtoBeGreaterThan(
[35m0[39m)[33m;[39
m
     [90m 96 |[39m  
   expect(res[33m.[3
9mbody[33m.[39mdata[
[35m0[39m][33m.[39
mtrip[33m.[39mtitle)
[33m.[39mtoBe([32m"
Test Expedition"[39m)
[33m;[39m
     [90m 97 |[39m  
 })[33m;[39m[0m

      at 
Object.<anonymous> (te
sts/integration/bookin
g.test.ts:94:42)


  ΓùÅ Test suite 
failed to run

    TypeError: queue_1
.notificationQueue.clo
se is not a function

    [0m [90m 62 
|[39m   afterAll([36
masync[39m () 
[33m=>[39m {
     [90m 63 |[39m  
   [36mawait[39m pri
sma[33m.[39m$disconn
ect()[33m;[39m
    [31m[1m>[22m[3
9m[90m 64 |[39m     
[36mawait[39m notifi
cationQueue[33m.[39m
close()[33m;[39m 
[90m// Ensure queue 
connection is 
closed[39m
     [90m    |[39m  
                      
     
[31m[1m^[22m[39m
     [90m 65 |[39m  
 })[33m;[39m
     [90m 66 |[39m
     [90m 67 |[39m  
 it([32m"should 
create a new booking"
[39m[33m,[39m 
[36masync[39m () 
[33m=>[39m {[0m

      at 
Object.<anonymous> (te
sts/integration/bookin
g.test.ts:64:29)

Test Suites: 1 
failed, 1 total
Tests:       2 
failed, 2 passed, 4 
total
Snapshots:   0 total
Time:        8.656 s, 
estimated 10 s
Ran all test suites 
matching /tests\\integ
ration\\booking.test.t
s/i.

Running global teardown...
Global teardown complete: Database cleaned.
Force exiting Jest: 
Have you considered 
using 
`--detectOpenHandles` 
to detect async 
operations that kept 
running after all 
tests finished?
npm error Lifecycle 
script `test` failed 
with error:
npm error code 1
npm error path C:\User
s\akash\Documents\Para
m_Adventures_Phase1\ap
ps\api
npm error workspace 
api@1.0.0
npm error location C:\
Users\akash\Documents\
Param_Adventures_Phase
1\apps\api
npm error command 
failed
npm error command C:\W
INDOWS\system32\cmd.ex
e /d /s /c jest 
--config 
jest.config.js tests/i
ntegration/booking.tes
t.ts
